-*- org -*-

* VAGUE FUTURE IDEAS
** TODO Garbage collecting of metadata files?
** TODO Handling of circular dependencies
* [100%] a. Early error messages
  Check early error messages (missing files, bad options) are emitted properly.
** DONE a01. Build, missing sourcedir
   Attempt to build target when there is no source dir.

   * FAILURE
     + Exit status: 10
     + Target: not existing
     + Metadata: not existing
     + Tempfile: not existing
** DONE a02. Build, missing scriptdir
   Attempt to build target when there is no script dir.

   * FAILURE
     + Exit status: 10
     + Target: not existing
     + Metadata: not existing
     + Tempfile: not existing
** DONE a03. Build, missing buildscript
   Attempt to build target when there is no buildscript for it.

   * FAILURE
     + Exit status: 10
     + Target: not existing
     + Metadata: not existing
     + Tempfile: not existing
** DONE a04. Build, buildscript missing read bits
   Attempt to build target with buildscript with read bits unset.

   * FAILURE
     + Exit status: 10
     + Target: not existing
     + Metadata: not existing
     + Tempfile: not existing
** DONE a05. Build, buildscript missing execute bits
   Attempt to build target with buildscript with execute bits unset.

   * FAILURE
     + Exit status: 10
     + Target: not existing
     + Metadata: not existing
     + Tempfile: not existing
* [100%] b. One target with no dependencies
  Check buildscript return values, that target and metadata files are only
  updated when they should, and that file timestamps does not affect this.
** DONE b01. Build, buildscript failing
   Attempt to build target with buildscript that returns non-zero exit status.

   * FAILURE
     + Exit status: 5
     + Target: not existing
     + Metadata: not existing
     + Tempfile: existing
** DONE b02. Build, buildscript successful
   Build target with buildscript that returns zero exit status.

   This result in a base setup, with one successfully built target.

   * SUCCESS
     + Exit status: 0
     + Target: existing
     + Metadata: existing
     + Tempfile: not existing
** DONE b03. Rebuild, unmodified
   CLOSED: [2014-07-07 Mon 09:04]
   Rebuild target that has already been built. (Based on b02.)

   * SUCCESS
     + Exit status: 0
     + Target: unmodified
     + Metadata: unmodified
     + Tempfile: not existing
** DONE b04. Rebuild, target time in past
   CLOSED: [2014-07-08 Tue 08:44]
   Rebuild target that has already been built after target file's timestamp
   have been moved into the past. (Based on b02.)

   Target timestamp is set to: 2000-01-01

   * SUCCESS
     + Exit status: 0
     + Target: unmodified
     + Metadata: unmodified
     + Tempfile: not existing
** DONE b05. Rebuild, target time in future
   CLOSED: [2014-07-08 Tue 08:44]
   Rebuild target that has already been built after target file's timestamp
   have been moved into the future. (Based on b02.)

   Target timestamp is set to: 2030-01-01

   * SUCCESS
     + Exit status: 0
     + Target: unmodified
     + Metadata: unmodified
     + Tempfile: not existing
** DONE b06. Rebuild, buildscript time in past
   CLOSED: [2014-07-08 Tue 14:13]
   Rebuild target that has already been built after target's buildscript's
   timestamp have been moved into the past. (Based on b02.)

   Target timestamp is set to: 2000-01-01

   * SUCCESS
     + Exit status: 0
     + Target: unmodified
     + Metadata: unmodified
     + Tempfile: not existing
** DONE b07. Rebuild, buildscript time in future
   CLOSED: [2014-07-08 Tue 14:29]
   Rebuild target that has already been built after target's buildscript's
   timestamp have been moved into the future. (Based on b02.)

   Target timestamp is set to: 2030-01-01

   * SUCCESS
     + Exit status: 0
     + Target: unmodified
     + Metadata: unmodified
     + Tempfile: not existing
** DONE b08. Rebuild, metadata time in past
   CLOSED: [2014-07-09 Wed 09:12]
   Rebuild target that has already been built after target's metadata file's
   timestamp have been moved into the past. (Based on b02.)

   Target timestamp is set to: 2000-01-01

   * SUCCESS
     + Exit status: 0
     + Target: unmodified
     + Metadata: unmodified
     + Tempfile: not existing
** DONE b09. Rebuild, metadata time in future
   CLOSED: [2014-07-09 Wed 09:11]
   Rebuild target that has already been built after target's metadata file's
   timestamp have been moved into the future. (Based on b02.)

   Target timestamp is set to: 2030-01-01

   * SUCCESS
     + Exit status: 0
     + Target: unmodified
     + Metadata: unmodified
     + Tempfile: not existing
** DONE b10. Rebuild, buildscript same output
   CLOSED: [2014-07-11 Fri 17:15]
   Rebuild target after buildscript modified (by a comment or similar) in such
   a way that it still produces the same output as it previously did. (Based on
   b02.)

   FIXME: TODO test - Metadata should be updated to contain buildscript checksum

   * SUCCESS
     + Exit status: 0
     + Target: unmodified
     + Metadata: unmodified
     + Tempfile: not existing
** DONE b11. Rebuild, buildscript failing
   CLOSED: [2014-07-11 Fri 17:32]
   Rebuild target after buildscript have been changed so that it now fails.
   (Based on b02.)

   * SUCCESS
     + Exit status: 5
     + Target: unmodified
     + Metadata: unmodified
     + Tempfile: existing
** DONE b12. Rebuild, buildscript new output
   CLOSED: [2014-07-11 Fri 17:23]
   Rebuild target after buildscript have been changed so that it outputs
   something new. (Based on b02.)

   * SUCCESS
     + Exit status: 0
     + Target: modified
     + Metadata: modified
     + Tempfile: not existing
** DONE b13. Rebuild, target modified
   CLOSED: [2014-07-11 Fri 17:46]
   Attempt to rebuild target when previous target exist and is modified. (Based
   on b02.)

   * FAILURE
     + Exit status: 1
     + Target: unmodified
     + Metadata: unmodified
     + Tempfile: existing
** DONE b14. Rebuild, target modified but time same
   CLOSED: [2014-07-26 Sat 21:43]
   Attempt to rebuild target when previous target exist and is modified, but
   its timestamp and size is the same as last time. (Based on b02.)

   Note that we only fiddle with the timestamp, not the the entire stat
   fingerprint. The stat fingerprint could (conceivably) be tricked, but this
   really beyond the scope of these test, as this is highly unlikely.

   * FAILURE
     + Exit status: 1
     + Target: unmodified
     + Metadata: unmodified
     + Tempfile: existing
** DONE b15. Rebuild, buildscript modified
   CLOSED: [2014-07-27 Sun 12:56]
   Rebuild target when previous target exists, but the buildscript has been
   modified. (Based on b02.)

   * SUCCESS
     + Exit status: 0
     + Target: modified
     + Metadata: modified
     + Tempfile: not existing
** DONE b16. Rebuild, buildscript modified but time same
   CLOSED: [2014-07-27 Sun 13:07]
   Rebuild target when previous target exists, and the buildscript has been
   modified, but the buildscript timestamp and size is the same as last time.
   (Based on b02.)

   Note that we only fiddle with the timestamp, not the the entire stat
   fingerprint. The stat fingerprint could (conceivably) be tricked, but this
   really beyond the scope of these test, as this is highly unlikely.

   * SUCCESS
     + Exit status: 0
     + Target: modified
     + Metadata: modified
     + Tempfile: not existing
** DONE b17. Rebuild, buildscript+target modified but same
   CLOSED: [2014-07-11 Fri 19:40]
   Rebuild target when previous target exist and is modified, but buildscript
   is also modified and builds a target identical to modified the modified one.

   * SUCCESS
     + Exit status: 0
     + Target: unmodified
     + Metadata: modified
     + Tempfile: not existing
* [25%] c. Lockfile-related stuff
  Check that lockfile is cleared on non-normal termination. And that it works
  to avert parallel execution of fix.
** DONE c01. Run two simultaneous instances of fix
   Attempt to run two copies of fix at once. First instance should build,
   second instance should detect lockfile and refuse to start.

   * 1st instance: SUCCESS
     + Exit status: 0
     + Target: existing
     + Metadata modified.
     + Tempfile: not existing

   * 2nd instance: FAILURE
     + Exit status: 8
     + Target: not existing
     + Tempfile: not existing
** TODO c02. Receiving Ctrl-C (SIGTERM)
   Send ctrl-c (SIGINT) to fix as its building and see that it returns correct
   exit code and clears its lockfile.

   This signal should be sent to fix's process group by means of a negative PID
   (in order to kill all subprocesses).

   * FAILURE
     + Exit status: 130 (128 + 2 = INT)
     + No lockfile exists.
** TODO c03. Normal kill (SIGINT)
   Send SIGTERM to fix as its building and see that it returns correct exit
   code and clears its lockfile.

   This signal should be sent to fix's process group by means of a negative PID
   (in order to kill all subprocesses).

   * FAILURE
     + Exit status: 143 (128 + 15 = TERM)
     + No lockfile exists.
** TODO c04. Terminal hangup (SIGHUP)
   Send SIGHUP to fix as its building and see that it returns correct exit code
   and clears its lockfile.

   This signal should be sent to fix's process group by means of a negative PID
   (in order to kill all subprocesses).

   * FAILURE
     + Exit status: 129 (128 + 1 = HUP)
     + No lockfile exists.
* [0%] d. Automatic buildscript dependency
  Checks to see that the automatically added dependency on the buildscript
  works as it should.
* [0%] e. Source dependency
** TODO Build, missing sourcedep
   Attempt to build a target for which there is a missing source dependency.
** TODO Build, sourcedep missing read bits
   Attempt to build target with source dependency with read bits unset.
** TODO Build, sourcedep
   Build target with source dependency.

   The target should include the source dependency, and checks should see that
   it's included.
** TODO Rebuild, sourcedep unmodified
   Rebuild target with source dependency that has already been built.
** TODO Rebuild, sourcedep time in past
   Rebuild target with source dependency that has already been built after the
   source dependency file's timestamp have been moved into the past.

   Source dependency timestamp is set to: 2000-01-01
** TODO Rebuild, sourcedep time in future
   Rebuild target with source dependency that has already been built after
   source dependency file's timestamp have been moved into the future. (Based
   on 07.)

   Source dependency timestamp is set to: 2030-01-01
** TODO Rebuild, sourcedep modified
** TODO Rebuild, sourcedep modified but time same
* [0%] f. Target dependency
** TODO Build target with one dependency
   Build target A with dependency B
   * SUCCESS
     + Exit status: 0
     + Both targets created.
     + Both metadata files created.
** TODO Rebuild target with one dependency
  * SUCCESS
    + Exit status: 0
    + Neither target modified.
    + Neither metadata file modified.
** TODO Rebuild target with modified dependency
** TODO Rebuild target with erased metadata and modified buildscript
   Attempt to rebuild target when previous target exist but have no metadata
   stored, and the newly built target differs from the old target.

   * FAILURE
     + Exit status: 1
** TODO Rebuild target with erased metadata
   Rebuild target when previous target exist but have no metadata stored, and
   the newly built target is the same as the old target.

   * SUCCESS
     + Exit status: 0
* [0%] g. 'default.fix' target dependency
** TODO Build using default buildscript ('default.fix')
   Build target using default.fix.
** TODO Build using default buildscript in parent dir
   Build target using '../default.fix'.
** TODO Rebuild target built by default buildscript, now by target
   Rebuild target that was previously build by default.fix, with a new
   TARGET.fix.
* [eof]
