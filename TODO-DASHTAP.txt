-*- org -*-

* Program
** TODO Functions that read stdin shouldn't determine when by testing stdin
   Functions that read standard input should not determine whether or not to
   read it by testing whether there is anything to read. Instead some other
   factor (e.g. number of args) should be used to determine whether or not to
   read it, and then give an error if there was nothing to read. (This toa avoid
   that nested functions all reading from standard input, interfere with each
   other.)
*** TODO 'indent'
    Only called from inside 'dashtap.sh', and never using stdin.
*** TODO 'note' (and thereby 'diag')
*** TODO 'setread'
*** TODO 'write_file'
*** DONE 'match'
*** DONE 'execute'
    CLOSED: [2014-07-22 Tue 14:29]
** TODO Eliminate as many $(...) as possible
   Each $(...) starts a subshell, which is inefficient, this should be avoided
   whenever possible.

   Could this be avoided in 'setread', for example?
** TODO Separate docs from source code
   Using Markdown?
** TODO Separate Fix.sh test helper functions from Dashtap
** TODO Put Dashtap in its own GitHub repo
   This would have to be automatically cloned and built by the Fix.sh build
   system. (Or at least have a very simple way of doing this described in the
   README.)
** TODO Merge 'is_changed' and 'is_unchanged' to follow DRY
** TODO Fix space-in-filename problem with timestamps                   :BUG:
   'timestamp'/'is_changed'/'is_unchanged'
* To think about
** TODO Merge 'execute' and 'seteval'?
** TODO Should 'error' output be compatible with TAP?
   Currently 'error' just aborts and outputs something on stderr, but should it
   also be prefixed with '# '?
* Testing
** TODO Tests should use 'title'
** TODO 'dashtap-todo.t' and 'dashtap-skip.t' should be very similar
   Currently there is some testing of ' and " in one of them.
** TODO Test 'dashtap_init'
** TODO Test 'dashtap_exit'
** TODO Test 'done_testing'
** TODO Test 'skip_all'
** TODO Test 'BAIL_OUT'
** TODO Test 'diag'
** TODO Test 'note'
** TODO Test 'result'
** TODO Test 'pass'
** TODO Test 'fail'
** TODO Test 'ok'
** TODO Test 'is'
** TODO Test 'file_is'
** TODO Test 'file_exist'
** TODO Test 'file_not_exist'
** TODO Test 'timestamp'
** TODO Test 'is_unchanged'
** TODO Test 'init_test'
** TODO Test 'mkpath'
** TODO Test 'chtime'
** TODO Test 'write_file'
** TODO Test that each function is tested
** TODO Test whether each function returns or exits
* DONE
** DONE Test 'indent'
   CLOSED: [2014-07-11 Fri 10:19]
** DONE Test 'evalset'
   CLOSED: [2014-07-11 Fri 13:22]
** DONE Test 'error'
   CLOSED: [2014-07-11 Fri 16:53]
** DONE Add TODO tests
   CLOSED: [2014-07-12 Sat 18:18]
** DONE Change 'write_file' argument order
   CLOSED: [2014-07-13 Sun 06:27]
   Permission bits & date should come *before* filename (to be consistent with
   touch and chmod).
** DONE Add SKIP tests
   CLOSED: [2014-07-17 Thu 19:49]
** DONE Test 'TODO'
   CLOSED: [2014-07-18 Fri 18:31]
** DONE Test 'END_TODO'
   CLOSED: [2014-07-18 Fri 18:31]
** DONE 'execute' should use only one trap
   CLOSED: [2014-07-20 Sun 09:10]
   A simple echo should suffice to catch the 'FULL' case, instead of the trap
   at the end of the 'execute' function.
** DONE Test 'varname'
   CLOSED: [2014-07-20 Sun 15:01]
** DONE 'varname' should not allow empty string or '_'                  :BUG:
   CLOSED: [2014-07-20 Sun 15:01]
** DONE Added 'strip_newline' and modified 'seteval' to make use of it
   CLOSED: [2014-07-20 Sun 18:38]
** DONE Added test cases for 'strip_newline'
   CLOSED: [2014-07-20 Sun 18:40]
** DONE Add function 'setread VARNAME [+] [<FILE]'
   CLOSED: [2014-07-20 Sun 19:32]
   Should read standard input into variable named VARNAME (preserving all
   whitespace). This function should be used by 'file_is', and 'execute'.
** DONE 'execute' and 'file_is' now uses 'setread'
   CLOSED: [2014-07-21 Mon 14:43]
** DONE 'file_is' should only strip one trailing newline                :BUG:
   CLOSED: [2014-07-21 Mon 15:01]
   When this works, add test with two trailing newlines to
   'dashtap-strip_newline.t' as well.
** DONE Dashtap variables should have prefix DASHTAP_*
   CLOSED: [2014-07-21 Mon 16:06]
   Not TEST_* as they have now.
** DONE No references to DASHTAP_* variables outside 'dashtap.sh' itself
   CLOSED: [2014-07-21 Mon 16:06]
   Added 'dashtap_init' which can be used to re-initialize the variables (e.g.
   in author tests).
** DONE Function to test if a function exists
   CLOSED: [2014-07-21 Mon 22:02]
** DONE Rename test functions '*_exist' -> '*_exists'
   CLOSED: [2014-07-22 Tue 00:47]
** NOTDONE 'setread' should refuse pipe input
   CLOSED: [2014-07-22 Tue 00:59]

   We could use [ -p /dev/stdin ] in 'setread' to test whether was invoked in a
   pipe or not. But stopping the user from doing this would backfire, since it
   is sometimes desirable to use it in this way.

   E.g. if 'match' uses 'setread' to read its input from standard input, and
   then match was invoked by `echo "$STR" | match "$SUBSTR"`, the pipe error
   would abort match even though the only thing relevant here is the return
   status of 'match'.
** DONE Quote all <<"EOF" in test scripts
   CLOSED: [2014-07-22 Tue 01:06]
** DONE Test reading of stdin for 'match' function
   CLOSED: [2014-07-22 Tue 01:43]
** DONE Test 'execute'
   CLOSED: [2014-07-22 Tue 14:26]
** DONE 'setread' should support third string arg
   CLOSED: [2014-07-22 Tue 19:27]
   When this is added, also add a test to 'dashtap-setread.t' which test how
   'setread' reacts to input that does not end in newline.
** DONE 'title' -- Extra fail message
   CLOSED: [2014-07-23 Wed 03:43]
   Output as 'note' whenever it occurs, but also added as an extra fail message
   that can be set by a command, which will be displayed only as a diagnostic
   if there is a failure, and which is valid until it is reset.

   E.g. 'extra "TODO-related tests"' would add an extra line to the beginning
   of the failure message, like this:

       not ok 35 - Exit status
       #   TODO-related tests
       #   Failed test 'Exit status'
       #   in 'xt/dashtap-todo.t'
       #     GOT   : 255
       #     WANTED: 1
*** DONE 'seteval' argument change
    CLOSED: [2014-07-22 Tue 21:17]
    '+' should be first arg in parallel to 'setread'
*** DONE 'setread' argument change
    CLOSED: [2014-07-22 Tue 19:25]
    '+' should be first arg, to allow for unambiguous 3rd argument.
** DONE Test 'title'
   CLOSED: [2014-07-23 Wed 03:48]
** DONE Test 'end_title'
   CLOSED: [2014-07-23 Wed 03:49]
